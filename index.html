<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ValorTC</title>
  <link rel="icon" href="data:,">
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 24px; max-width: 920px; }
    h1 { margin: 0 0 12px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { display: block; font-weight: 600; margin-bottom: 6px; }
    input { width: 100%; padding: 10px; font-size: 16px; box-sizing: border-box; }
    table { width: 100%; border-collapse: collapse; margin-top: 14px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: right; }
    th:first-child, td:first-child { text-align: left; }
    th { background: #f6f6f6; }
    .out { font-weight: 700; }
    .yellow { background: #fff59d; }
    .center { text-align: center; }
    .debit { color:lightblue; font-size: 20px; margin-top: 10px; }
    .toolbar { display:flex; gap:10px; align-items:center; margin-top: 10px; flex-wrap: wrap; }
    button { padding: 10px 12px; font-size: 14px; cursor: pointer; border: 1px solid #ddd; border-radius: 10px; background: #fff; }
    button:hover { background: #f6f6f6; }
  </style>
</head>
<body>
  <h1>ValorTC</h1>

  <div class="card">
    <div class="grid">
      <div>
        <label for="contado">Contado (EFVO)</label>
        <input id="contado" type="number" inputmode="decimal" placeholder="Ej: 100000" />
      </div>
      <div>
        <label for="cohefDeb">COHEF Deb</label>
        <input id="cohefDeb" type="text" inputmode="decimal" placeholder="Ej: 1,037" />
      </div>
    </div>

    <div class="toolbar">
      <span class="debit">
        Débito = Contado × COHEF Deb — <span class="out">Débito:</span> <span id="debitoOut" class="out">—</span>
      </span>

      <span id="saveHint" class="muted"></span>
    </div>

    <table>
      <thead>
        <tr>
          <th>Crédito</th>
          <th class="center">COHEF</th>
          <th>Costo x cuota</th>
          <th>Costo total</th>
          <th class="yellow">Facturar esto</th>
          <th class="center">Coh</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1 pago</td>
          <td class="center"><input id="cohef_1"  type="text" inputmode="decimal" placeholder="1,05"></td>
          <td id="cuota_1">—</td>
          <td id="total_1" class="out">—</td>
          <td id="fact_1" class="yellow out">—</td>
          <td class="center"><input id="coh_1"    type="text" inputmode="decimal" placeholder="1,06"></td>
        </tr>
        <tr>
          <td>3 pagos</td>
          <td class="center"><input id="cohef_3"  type="text" inputmode="decimal" placeholder="1,07"></td>
          <td id="cuota_3">—</td>
          <td id="total_3" class="out">—</td>
          <td id="fact_3" class="yellow out">—</td>
          <td class="center"><input id="coh_3"    type="text" inputmode="decimal" placeholder="1,08"></td>
        </tr>
        <tr>
          <td>6 pagos</td>
          <td class="center"><input id="cohef_6"  type="text" inputmode="decimal" placeholder="1,09"></td>
          <td id="cuota_6">—</td>
          <td id="total_6" class="out">—</td>
          <td id="fact_6" class="yellow out">—</td>
          <td class="center"><input id="coh_6"    type="text" inputmode="decimal" placeholder="1,1"></td>
        </tr>
        <tr>
          <td>9 pagos</td>
          <td class="center"><input id="cohef_9"  type="text" inputmode="decimal" placeholder="1,2"></td>
          <td id="cuota_9">—</td>
          <td id="total_9" class="out">—</td>
          <td id="fact_9" class="yellow out">—</td>
          <td class="center"><input id="coh_9"    type="text" inputmode="decimal" placeholder="1,3"></td>
        </tr>
        <tr>
          <td>12 pagos</td>
          <td class="center"><input id="cohef_12" type="text" inputmode="decimal" placeholder="1,4"></td>
          <td id="cuota_12">—</td>
          <td id="total_12" class="out">—</td>
          <td id="fact_12" class="yellow out">—</td>
          <td class="center"><input id="coh_12"   type="text" inputmode="decimal" placeholder="1,5"></td>
        </tr>
      </tbody>
    </table>

    <button id="clearBtn" type="reset" title="Borra los coef. guardados">
      Limpiar valores guardados
    </button>

  </div>

  <script>
    const fmtARS = new Intl.NumberFormat("es-AR", { style: "currency", currency: "ARS" });

    // conservar datos
    const STORE_KEY = "valorTC_v1";
    const saveHintEl = document.getElementById("saveHint");

    function saveState() {
      const data = {};
      document.querySelectorAll("input").forEach(inp => {
        if (inp.id) data[inp.id] = inp.value;
      });
      localStorage.setItem(STORE_KEY, JSON.stringify(data));

      // aviso de guardado
      if (saveHintEl) {
        saveHintEl.textContent = "Guardado ✓";
        clearTimeout(window.__saveHintTimer);
        window.__saveHintTimer = setTimeout(() => saveHintEl.textContent = "", 900);
      }
    }

    function loadState() {
      const raw = localStorage.getItem(STORE_KEY);
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        Object.entries(data).forEach(([id, val]) => {
          const el = document.getElementById(id);
          if (el) el.value = val;
        });
      } catch (e) {
        console.warn("Estado guardado inválido, se ignora");
      }
    }

    // number
    function n(v) {
      if (v === null || v === undefined) return NaN;
      const s = String(v).trim().replace(/\./g, "").replace(",", ".");
      const x = Number(s);
      return Number.isFinite(x) ? x : NaN;
    }

    function setText(id, value, isMoney = true) {
      const el = document.getElementById(id);
      if (!el) return;
      el.textContent = isMoney ? fmtARS.format(value) : String(value);
    }

    function safeText(id, txt) {
      const el = document.getElementById(id);
      if (el) el.textContent = txt;
    }

    // calcular
    function recalc() {
      const contadoEl = document.getElementById("contado");
      const cohefDebEl = document.getElementById("cohefDeb");
      if (!contadoEl || !cohefDebEl) return;

      const contado = n(contadoEl.value);
      const cohefDeb = n(cohefDebEl.value);

      if (!Number.isFinite(contado) || contado <= 0) {
        safeText("debitoOut", "—");
        return;
      }

      // Débito
      if (Number.isFinite(cohefDeb)) setText("debitoOut", contado * cohefDeb, true);
      else safeText("debitoOut", "—");

      const rows = [
        { pagos: 1,  cohefId: "cohef_1",  cohId: "coh_1",  cuotaOut: "cuota_1",  totalOut: "total_1",  factOut: "fact_1" },
        { pagos: 3,  cohefId: "cohef_3",  cohId: "coh_3",  cuotaOut: "cuota_3",  totalOut: "total_3",  factOut: "fact_3" },
        { pagos: 6,  cohefId: "cohef_6",  cohId: "coh_6",  cuotaOut: "cuota_6",  totalOut: "total_6",  factOut: "fact_6" },
        { pagos: 9,  cohefId: "cohef_9",  cohId: "coh_9",  cuotaOut: "cuota_9",  totalOut: "total_9",  factOut: "fact_9" },
        { pagos: 12, cohefId: "cohef_12", cohId: "coh_12", cuotaOut: "cuota_12", totalOut: "total_12", factOut: "fact_12" },
      ];

      for (const r of rows) {
        const cohefEl = document.getElementById(r.cohefId);
        const cohEl = document.getElementById(r.cohId);

        const cohef = cohefEl ? n(cohefEl.value) : NaN;
        const coh = cohEl ? n(cohEl.value) : NaN;

        // Facturar
        const fact = Number.isFinite(coh) ? (contado * coh) : NaN;
        if (Number.isFinite(fact)) setText(r.factOut, fact, true);
        else safeText(r.factOut, "—");

        // Total
        let total = NaN;
        if (Number.isFinite(cohef)) {
          if (r.pagos === 1) total = contado * cohef;
          else if (Number.isFinite(fact)) total = fact * cohef;
        }

        if (Number.isFinite(total)) {
          setText(r.totalOut, total, true);
          setText(r.cuotaOut, total / r.pagos, true);
        } else {
          safeText(r.totalOut, "—");
          safeText(r.cuotaOut, "—");
        }
      }
    }

    // eventos
    window.addEventListener("input", (e) => {
      if (e.target && e.target.tagName === "INPUT") {
        saveState();
        recalc();
      }
    });

    document.getElementById("clearBtn").addEventListener("click", () => {
      localStorage.removeItem(STORE_KEY);
      // limpiar
      document.querySelectorAll("input").forEach(i => i.value = "");
      recalc();
      if (saveHintEl) saveHintEl.textContent = "Limpio.";
      setTimeout(() => { if (saveHintEl) saveHintEl.textContent = ""; }, 900);
    });

    // carga
    loadState();
    recalc();
  </script>
</body>
</html>
